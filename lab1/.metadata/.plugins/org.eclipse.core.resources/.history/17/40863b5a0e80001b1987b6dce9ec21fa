package example;

import java.awt.Desktop;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileWriter;
import java.io.IOException;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.util.Scanner;

import javax.swing.JOptionPane;

public class Encoder {
	
	public static void snapshoot(String path) {
		FileWriter writeFile = null;
		String textToWrite = "";
        try {
            dirToOpen = new File(path);
            
            try {
            	Desktop.open(dirToOpen);
				new File("Pathnames.txt");
				writeFile = new FileWriter("Pathnames.txt");
				
				pathnames = dirToOpen.list();
				for ( String i: pathnames) {
					textToWrite = i;
		           	writeFile.write(textToWrite+"\n");
				}
				
				
	            if (writeFile != null) {
	            	writeFile.close();
	            }
	            
			} catch (IOException e1) {
				 System.out.println("File cannot be open");
			}
        } catch (IllegalArgumentException iae) {
            System.out.println("File Not Found");
        } 
	}
	
	
	public static void snapshootMD5(String path) {
		FileWriter writeFile = null;
		String textToWrite = "";
		dirToOpen = new File(path);
        
        try {
			new File("MD5.txt");
			writeFile = new FileWriter("MD5.txt");
			
			pathnames = dirToOpen.list();
			for ( String i: pathnames) {
				textToWrite = i;
	           	byte[] text = textToWrite.getBytes("UTF-8");
				MessageDigest md = MessageDigest.getInstance("MD5");
				byte[] thedigest = md.digest(text);	
				md.update(thedigest);
				for(Byte x: thedigest) {
				    writeFile.write(Integer.toHexString(x));
				}
			}
			
			
            if (writeFile != null) {
            	writeFile.close();
            }
            
		} catch (IOException e1) {
			 System.out.println("File cannot be open");
		} catch (IllegalArgumentException iae) {
        System.out.println("File Not Found");
		} catch (NoSuchAlgorithmException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} 
		
		
	}

	public static void verify(String path) {
		dirToOpen = new File(path);
		String dataFromFile = new String();
        String newMD5 = new String();
        int keyCounter = 0;
        try {
        	
		    try {
		        File myObj = new File("MD5.txt");
		        Scanner myReader = new Scanner(myObj);
		        while (myReader.hasNextLine()) {

		          String data = myReader.nextLine();
		          dataFromFile+=data;	
		        }
		        myReader.close();
		      } catch (FileNotFoundException e) {
		        System.out.println("An error occurred.");
		        e.printStackTrace();
		      }
		    
			pathnames = dirToOpen.list();
			for ( String i: pathnames) {
	           	byte[] text = i.getBytes("UTF-8");
				MessageDigest md = MessageDigest.getInstance("MD5");
				byte[] thedigest = md.digest(text);	
				md.update(thedigest);
				
				for(Byte x: thedigest) {
					newMD5+=Integer.toHexString(x);
			}
			}
			
			if (newMD5.equals(dataFromFile)) {
				JOptionPane.showMessageDialog(null, "Nothing new in a file");
			}
			else {
				JOptionPane.showMessageDialog(null, "There's something new in a file");
			}
			
		} catch (IOException e1) {
			 System.out.println("File cannot be open");
		} catch (IllegalArgumentException iae) {
        System.out.println("File Not Found");
		} catch (NoSuchAlgorithmException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} 
	}
	
}
