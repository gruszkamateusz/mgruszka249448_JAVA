package application;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

public class CustomClassLoader extends ClassLoader {
    private Path searchPath;

    public CustomClassLoader(Path path) {
        if (!Files.isDirectory(path)) throw new IllegalArgumentException("Path must be a directory");
        searchPath = path;
    }

    @Override
    protected Class<?> findClass(String fileName) throws ClassNotFoundException {
        try {
            Path filePath = Paths.get(searchPath + "/" + fileName);
            byte[] classBytes = Files.readAllBytes(filePath);
            Class<?> cl = defineClass(null, classBytes, 0, classBytes.length);
            if (cl == null) throw new ClassNotFoundException(fileName);
            Class[] interfaces =  cl.getInterfaces();
            for(Class interf: interfaces) {
                if(interf.getName().equals("processing.Processor"))
                    return cl;
            }
            throw new ClassNotFoundException("Class must implements interface processing.Processor");
        } catch (IOException e) {
            throw new ClassNotFoundException(fileName);
        }
    }
}

