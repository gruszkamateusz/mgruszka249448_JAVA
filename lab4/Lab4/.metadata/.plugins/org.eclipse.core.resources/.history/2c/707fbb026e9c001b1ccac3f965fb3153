package application;

import java.io.IOException;
import java.nio.file.FileSystems;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

public class CustomClassLoader extends ClassLoader {
    private Path searchPath;
    
    public CustomClassLoader(Path path) {
        if (!Files.isDirectory(path)) throw new IllegalArgumentException("Path must be a directory");
        searchPath = path;
    }

    @Override
	public Class<?> findClass(String fileName) throws ClassNotFoundException {
    	System.out.println(fileName);
    	if(fileName.contains(".")) {
    		fileName = fileName.replaceAll(".", FileSystems.getDefault().getSeparator());
    	}
    	System.out.println(fileName);
    	 byte[] classBytes = null;
    	 
        try {
        	System.out.println(searchPath + FileSystems.getDefault().getSeparator() 
            		+ fileName+ ".class");
            Path filePath = Paths.get(searchPath + FileSystems.getDefault().getSeparator() 
            		+ fileName +".class");
            
           classBytes = Files.readAllBytes(filePath);
           
        	System.out.println(classBytes.length);
            
            
        	} catch (IOException e) {
            throw new ClassNotFoundException(fileName);
        }
        return defineClass(null, classBytes, 0, classBytes.length);
    }
}

