package org.example.SoapISPService.soap;

import java.time.LocalDate;
import java.util.List;

import javax.annotation.PostConstruct;
import javax.jws.WebMethod;
import javax.jws.WebService;

import org.example.SoapISPService.dao.ChargeDao;
import org.example.SoapISPService.dao.ClientDao;
import org.example.SoapISPService.dao.InstallationDao;
import org.example.SoapISPService.dao.TariffDao;
import org.example.SoapISPService.model.Charge;
import org.example.SoapISPService.model.Client;
import org.example.SoapISPService.model.Installation;
import org.example.SoapISPService.model.Tariff;

@WebService(endpointInterface = "org.example.SoapISPService.soap.ClientSoapInt")
public class ClientSoapImpl implements ClientSoapInt {
	@PostConstruct
	private void init() {
		System.out.println("In ClientSoapImpl init");
		ClientDao.createTable();
	}
	
	@WebMethod
	public void insertTestData() {
		Client cl0 = new Client(-1, "Name1", "Surname1");
		Client cl1 = new Client(-1, "Name2", "Surname2");
		Client cl2 = new Client(-1, "Name3", "Surname3");
		Client cl3 = new Client(-1, "Name4", "Surname4");
		Client cl4 = new Client(-1, "Name5", "Surname5");
		Client cl5 = new Client(-1, "Name6", "Surname6");
		cl0.setId(ClientDao.insert(cl0));
		cl1.setId(ClientDao.insert(cl1));
		cl2.setId(ClientDao.insert(cl2));
		cl3.setId(ClientDao.insert(cl3));
		cl4.setId(ClientDao.insert(cl4));
		cl5.setId(ClientDao.insert(cl5));
		Tariff tar0 = new Tariff(-1, "1", 9.99);
		Tariff tar1 = new Tariff(-1, "2", 19.99);
		Tariff tar2 = new Tariff(-1, "3", 29.99);
		Tariff tar3 = new Tariff(-1, "4", 39.99);
		Tariff tar4 = new Tariff(-1, "5", 49.99);
		Tariff tar5 = new Tariff(-1, "6", 59.99);
		tar0.setId(TariffDao.insert(tar0));
		tar1.setId(TariffDao.insert(tar1));
		tar2.setId(TariffDao.insert(tar2));
		tar3.setId(TariffDao.insert(tar3));
		tar4.setId(TariffDao.insert(tar4));
		tar5.setId(TariffDao.insert(tar5));		
		Installation ins0 = new Installation(-1, cl0.getId(), "1", tar0.getId());
		Installation ins1 = new Installation(-1, cl1.getId(), "2", tar1.getId());
		Installation ins2 = new Installation(-1, cl2.getId(), "3", tar2.getId());
		Installation ins3 = new Installation(-1, cl3.getId(), "4", tar3.getId());
		Installation ins4 = new Installation(-1, cl4.getId(), "5", tar4.getId());
		Installation ins5 = new Installation(-1, cl5.getId(), "6", tar5.getId());
		Installation ins6 = new Installation(-1, cl5.getId(), "7", tar2.getId());
		ins0.setId(InstallationDao.insert(ins0));
		ins1.setId(InstallationDao.insert(ins1));
		ins2.setId(InstallationDao.insert(ins2));
		ins3.setId(InstallationDao.insert(ins3));
		ins4.setId(InstallationDao.insert(ins4));
		ins5.setId(InstallationDao.insert(ins5));
		ins6.setId(InstallationDao.insert(ins6));
		Charge ch0 = new Charge(-1, ins0.getId(), LocalDate.now().plusDays(10).toString(), tar0.getPrice());
		Charge ch1 = new Charge(-1, ins1.getId(), LocalDate.now().plusDays(20).toString(), tar1.getPrice());
		Charge ch2 = new Charge(-1, ins2.getId(), LocalDate.now().plusDays(30).toString(), tar2.getPrice());
		Charge ch3 = new Charge(-1, ins3.getId(), LocalDate.now().plusDays(40).toString(), tar3.getPrice());
		Charge ch4 = new Charge(-1, ins4.getId(), LocalDate.now().plusDays(15).toString(), tar4.getPrice());
		Charge ch5 = new Charge(-1, ins5.getId(), LocalDate.now().plusDays(25).toString(), tar5.getPrice());
		Charge ch6 = new Charge(-1, ins6.getId(), LocalDate.now().plusDays(60).toString(), tar2.getPrice());
		ch0.setId(ChargeDao.insert(ch0));
		ch1.setId(ChargeDao.insert(ch1));
		ch2.setId(ChargeDao.insert(ch2));
		ch3.setId(ChargeDao.insert(ch3));
		ch4.setId(ChargeDao.insert(ch4));
		ch5.setId(ChargeDao.insert(ch5));
		ch6.setId(ChargeDao.insert(ch6));
		for(int i = 0; i < 30; ++i) {
			Charge ch = new Charge(-1, ins6.getId(), LocalDate.now().plusDays(i*10).toString(), tar2.getPrice());
			ChargeDao.insert(ch);
		}
	}
	
	@WebMethod
	public Client createClient(String name, String firstName) {
		Client cl = new Client(-1, name, firstName);
		cl.setId(ClientDao.insert(cl));
		return cl;
	}

	@WebMethod
	public int removeClient(long clientId) {
		return ClientDao.delete(clientId);
	}

	@WebMethod
	public Client getClient(long clientId) {
		return ClientDao.get(clientId);
	}
	
	@WebMethod
	public List<Client> getAllClients() {
		return ClientDao.getAll();
	}
}
