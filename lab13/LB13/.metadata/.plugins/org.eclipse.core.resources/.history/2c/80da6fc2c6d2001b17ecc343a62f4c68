<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?language javascript?>
<BorderPane fx:id="borderpane" maxHeight="-Infinity" maxWidth="-Infinity" minHeight="-Infinity" minWidth="-Infinity" prefHeight="400.0" prefWidth="655.0" xmlns="http://javafx.com/javafx/11.0.1" xmlns:fx="http://javafx.com/fxml/1">
    <fx:script>
        var tFile = Java.type("java.io.File");
        var WishTemplate = Java.type("application.WishTemplate");
        var RadioMenuItem = Java.type("javafx.scene.control.RadioMenuItem");
        var ToggleGroup = Java.type("javafx.scene.control.ToggleGroup");
        var JOptionPane = Java.type("javax.swing.JOptionPane");
        var System = Java.type("java.lang.System")
        var Main = Java.type("application.Main");

        function loadFolderFiles(path) {
            var file = new tFile(path);
            System.out.println(file.getPath());
            return file.listFiles();
        }

        function fillTemplateList() {
            var url = Main.getResourceDir("application/templates/");
            files = loadFolderFiles(url);
            if(files == null) {
                files = loadFolderFiles("./resrc/application/templates");
            }
            for(i in files) {
                wishesList.getItems().add(new WishTemplate(files[i]));
            }
        }

        var strategies = ["Manualnie", "Losowo", "Kolejno", "Najdłuższe", "Najkrótsze"];
        function fillStrategyChoiceBox() {
            for(i in strategies)
                choiceBoxStrategy.getItems().add(strategies[i]);
            choiceBoxStrategy.getSelectionModel().select(0);
        }

        var guiStyles = ["Jasny", "Ciemny", "Fiołkowy"];
        var styleToggleGroup = new ToggleGroup();
        function fillGUIStyleChooser() {
            for(i in guiStyles) {
                var radioBtn = new RadioMenuItem(guiStyles[i]);
                radioBtn.setToggleGroup(styleToggleGroup);
                guiStyleChooser.getItems().add(radioBtn);
            }
            styleToggleGroup.selectToggle(guiStyleChooser.getItems().get(0));
        }

        function onGUIStyleChooserAction() {
            var id = styleToggleGroup.getToggles().indexOf(styleToggleGroup.getSelectedToggle());
            var scene = borderpane.getScene();
            scene.getStylesheets().clear();

            switch(id) {
                case 0:
                    scene.getStylesheets().add(Main.getResource("css/style_light.css"));
                    break;
                case 1:
                    scene.getStylesheets().add(Main.getResource("css/style_dark.css"));
                    break;
                case 2:
                    scene.getStylesheets().add(Main.getResource("css/style_violet.css"));
                    break;
                default:
                    break;
            }
        }

        function getShortestWishes() {
            wishesList.getItems().sort(null);
            return wishesList.getItems().get(0).getWishes();
        }

        function getLongestWishes() {
            wishesList.getItems().sort(null);
            return wishesList.getItems().get(wishesList.getItems().size()-1).getWishes();
        }

        function getChoosedWishes() {
            var wishesId = wishesList.getSelectionModel().getSelectedIndex();
            if(wishesId >= 0)
                return wishesList.getItems().get(wishesId).getWishes();
            return null;
        }

        function getRandomWishes() {
            var wihesId = Math.floor(Math.random() * wishesList.getItems().size());
            return wishesList.getItems().get(wihesId).getWishes();
        }

        var nextWishesId = 0;
        function getNextWishes() {
            var wishes = wishesList.getItems().get(nextWishesId).getWishes();
            ++nextWishesId;
            if(nextWishesId >= wishesList.getItems().size())
                nextWishesId = 0;
            return wishes;
        }

        function generateWishes() {
            var wisherName = tfWisherName.getText();
            var bpName = lblBirthdayPersonrName.getText();
            var strategyId = choiceBoxStrategy.getSelectionModel().getSelectedIndex();
            var wishes = "";
            switch (strategyId) {
            case 0:
                wishes = getChoosedWishes();
                if(wishes == null) {
                    JOptionPane.showMessageDialog(null, "Strategia wyboru manualnego. Wybierz życzenia z listy.");
                    return;
                }
                break;
            case 1:
                wishes = getRandomWishes();
                break;
            case 2:
                wishes = getNextWishes();
                break;
            case 3:
                wishes = getLongestWishes();
                break;
            case 4:
                wishes = getShortestWishes();
                break;
            default:
                wishes = null;
            }
            if(wishes == null) {
                JOptionPane.showMessageDialog(null, "Błąd: Nie udało się wczytać życzeń.");
                return;
            }
            if(bpName == null || bpName == "") {
                JOptionPane.showMessageDialog(null, "Podaj imię solenizanta");
                return;
            }
            if(wisherName == null || wisherName == "") {
                JOptionPane.showMessageDialog(null, "Podaj imię życzącego");
                return;
            }
            wishes = wishes.replace("{0}", bpName).replace("{1}", wisherName);
            taGeneratedWishes.setText(wishes);
        }
    </fx:script>
   <center>
      <AnchorPane prefHeight="200.0" prefWidth="200.0" BorderPane.alignment="CENTER">
         <children>
            <ListView fx:id="wishesList" layoutX="14.0" layoutY="68.0" prefHeight="279.0" prefWidth="203.0" AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.topAnchor="0.0" />
            <TextArea fx:id="taGeneratedWishes" layoutX="206.0" layoutY="87.0" prefHeight="261.0" prefWidth="432.0" AnchorPane.bottomAnchor="3.0" AnchorPane.leftAnchor="206.0" AnchorPane.rightAnchor="3.0" AnchorPane.topAnchor="87.0" />
            <TextField fx:id="tfWisherName" layoutX="342.0" layoutY="23.0" prefHeight="25.0" prefWidth="132.0" AnchorPane.leftAnchor="342.0" AnchorPane.topAnchor="23.0" />
            <Label fx:id="lblStrategy" layoutX="209.0" layoutY="6.0" text="Strategia wyboru:" AnchorPane.leftAnchor="209.0" AnchorPane.topAnchor="6.0" />
            <Label fx:id="lblWisherName" layoutX="342.0" layoutY="6.0" text="Imię życzącego:" AnchorPane.leftAnchor="342.0" AnchorPane.topAnchor="6.0" />
            <Button fx:id="btnGenerateWishes" layoutX="209.0" layoutY="55.0" mnemonicParsing="false" onAction="generateWishes()" prefHeight="25.0" prefWidth="427.0" text="Generuj życzenia" AnchorPane.leftAnchor="209.0" AnchorPane.rightAnchor="5.0" AnchorPane.topAnchor="55.0" />
            <ChoiceBox fx:id="choiceBoxStrategy" layoutX="209.0" layoutY="23.0" prefHeight="25.0" prefWidth="127.0" />
            <TextField fx:id="lblBirthdayPersonrName" layoutX="478.0" layoutY="23.0" />
            <Label layoutX="478.0" layoutY="6.0" text="Imię solenizanta:" />
         </children>
      </AnchorPane>
   </center>
   <top>
      <MenuBar BorderPane.alignment="CENTER">
        <menus>
            <Menu fx:id="guiStyleChooser" mnemonicParsing="false" onAction="onGUIStyleChooserAction()" text="Styl interfejsu" />
        </menus>
      </MenuBar>
   </top>
    <fx:script>
        fillTemplateList();
        fillStrategyChoiceBox();
        fillGUIStyleChooser();
    </fx:script>
</BorderPane>
